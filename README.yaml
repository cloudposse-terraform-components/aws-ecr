name: "aws-ecr"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-ecr"
# Short description of this project
description: |-
  This component is responsible for provisioning repositories, lifecycle rules, and permissions for streamlined ECR usage.
  This utilizes
  [the roles-to-principals submodule](https://github.com/cloudposse/terraform-aws-components/tree/main/modules/account-map/modules/roles-to-principals)
  to assign accounts to various roles. It is also compatible with the
  [GitHub Actions IAM Role mixin](https://github.com/cloudposse-terraform-components/mixins/blob/main/src/mixins/github-actions-iam-role/README-github-action-iam-role.md).

  <details>
    <summary>Warning (Older) regarding <code>eks-iam</code> component </summary>

  > [!WARNING]
  >
  > Older versions of our reference architecture have an`eks-iam` component that needs to be updated to provide sufficient
  > IAM roles to allow pods to pull from ECR repos

  </details>
usage: |-
  ## Usage

  **Stack Level**: Regional

  Here's an example snippet for how to use this component. This component is normally only applied once as the resources
  it creates are globally accessible, but you may want to create ECRs in multiple regions for redundancy. This is
  typically provisioned via the stack for the "artifact" account (typically `auto`, `artifact`, or `corp`) in the primary
  region.

  ```yaml
  components:
    terraform:
      ecr:
        vars:
          ecr_user_enabled: false
          enable_lifecycle_policy: true
          max_image_count: 500
          scan_images_on_push: true
          protected_tags:
            - prod
          image_tag_mutability: MUTABLE

          images:
            - infrastructure
            - microservice-a
            - microservice-b
            - microservice-c
          read_write_account_role_map:
            identity:
              - admin
              - cicd
            automation:
              - admin
          read_only_account_role_map:
            corp: ["*"]
            dev: ["*"]
            prod: ["*"]
            stage: ["*"]
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->
references:
  - name: "Decide How to distribute Docker Images"
    description: ""
    url: "https://docs.cloudposse.com/layers/software-delivery/design-decisions/decide-how-to-distribute-docker-images/"
  - name: "Decide on ECR Strategy"
    description: ""
    url: "https://docs.cloudposse.com/layers/project/design-decisions/decide-on-ecr-strategy/"
  - name: "Cloud Posse's upstream component"
    description: ""
    url: "https://github.com/cloudposse/terraform-aws-components/tree/main/modules/ecr"
tags:
  - component/ecr
  - layer/baseline
  - provider/aws
# Categories of this project
categories:
  - component/ecr
  - layer/baseline
  - provider/aws
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-ecr.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-ecr/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
